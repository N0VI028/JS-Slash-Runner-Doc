---
order: 1
---

# 修改预设

:::tip
请务必先阅读[如何正确使用酒馆助手](/guide/基本用法/如何正确使用酒馆助手.md)
:::

[点击查看对应类型定义文件 (可发给 AI 或 IDE 使用, 酒馆助手界面中提供了打包下载)](https://github.com/N0VI028/JS-Slash-Runner/blob/main/%40types/function/preset.d.ts)

<video src="/修改预设.mp4" type="video/mp4" controls />

<CustomTOC />

## loadPreset

加载 `preset_name` 预设作为酒馆正在使用的预设 (`'in_use'`)

```ts
function loadPreset(preset_name: Exclude<string, 'in_use'>): boolean;
```

### 参数

#### preset_name

- **类型**: `string`
- **描述**: 预设名称

### 返回值

- **是否成功切换, 可能因预设不存在等原因而失败**: `boolean`

## renamePreset

重命名 `preset_name` 预设为 `new_name`

```ts
function renamePreset(preset_name: Exclude<string, 'in_use'>, new_name: string): Promise<boolean>;
```

### 参数

#### preset_name

- **类型**: `string`
- **描述**: 预设名称

#### new_name

- **类型**: `string`
- **描述**: 新名称

### 返回值

- **是否成功重命名, 可能因预设不存在等原因而失败**: `boolean`

## replacePreset

完全替换 `preset_name` 预设的内容为 `preset`

:::code-group

```ts [replacePreset]
function replacePreset(
  preset_name: LiteralUnion<'in_use', string>,
  preset: Preset,
  { render }?: ReplacePresetOptions,
): Promise<void>
```

```ts [ReplacePresetOptions]
interface ReplacePresetOptions {
  render?: 'debounced' | 'immediate' | 'none';
}
```

:::

### 参数

#### preset_name

- **类型**: `string`
- **描述**: 预设名称

#### preset

- **类型**: [`Preset`](./获取预设.md#getpreset)
- **描述**: 预设内容

#### `option?`

一个可选的配置对象, 包含以下属性:

- **`render`**: `debounced|immediate|none`
  - 如果对 `'in_use'` 预设进行操作, 应该防抖渲染 (debounced)、立即渲染 (immediate) 还是不刷新前端显示 (none)? 默认为性能更好的防抖渲染

### 异常

- 如果预设不存在, 将会抛出异常
- 如果替换的预设内容中存在重复的系统/占位提示词, 将会抛出异常

### 示例

:::code-group

```ts [为酒馆正在使用的预设开启流式传输]
const preset = getPreset('in_use');
preset.settings.should_stream = true;
await replacePreset('in_use', preset);
```

```ts [关闭酒馆正在使用的预设中名字包含 "COT" 的条目]
const preset = getPreset('in_use');
preset.prompts.filter(prompt => prompt.name.includes('COT')).forEach(prompt => prompt.enabled = false);
await replacePreset('in_use', preset);
```

```ts [为酒馆正在使用的预设添加一个提示词条目]
const preset = getPreset('in_use');
preset.prompts.push({
  id: 'new_prompt',
  name: '新提示词',
  enabled: true,
  position: { type: 'relative' },
  role: 'user',
  content: '新提示词内容',
});
await replacePreset('in_use', preset);
```

```ts [将 '预设A' 的条目按顺序复制到 '预设B' 开头]
const preset_a = getPreset('预设A');
const preset_b = getPreset('预设B');
preset_b.prompts = [...preset_a.prompts, ...preset_b.prompts];
await replacePreset('预设B', preset_b);
```

:::

## updatePresetWith

用 `updater` 函数更新 `preset_name` 预设

::: code-group

```ts [updatePresetWith]
function updatePresetWith(
  preset_name: LiteralUnion<'in_use', string>,
  updater: PresetUpdater,
  { render }?: ReplacePresetOptions,
): Promise<Preset>;
```

```ts [PresetUpdater]
type PresetUpdater = ((preset: Preset) => Preset) | ((preset: Preset) => Promise<Preset>);
```

:::

### 参数

#### preset_name

- **类型**: `string`
- **描述**: 预设名称

#### updater

- **类型**: [`PresetUpdater`](./修改预设.md#updatepresetwith)
- **描述**: 用于更新预设的函数. 它应该接收预设内容作为参数, 并返回更新后的预设内容.

#### `option?`

一个可选的配置对象, 包含以下属性:

- **`render`**: `debounced|immediate|none`
  - 如果对 `'in_use'` 预设进行操作, 应该防抖渲染 (debounced)、立即渲染 (immediate) 还是不刷新前端显示 (none)? 默认为性能更好的防抖渲染

### 返回值

- **更新后的预设内容**: [`Preset`](./获取预设.md#getpreset)

### 异常

- 如果预设不存在, 将会抛出异常
- 如果替换的预设内容中存在重复的系统/占位提示词, 将会抛出异常

### 示例

:::code-group

```ts [为酒馆正在使用的预设开启流式传输]
await updatePresetWith('in_use', preset => {
  preset.settings.should_stream = true;
  return preset;
});
```

```ts [关闭酒馆正在使用的预设中名字包含 "COT" 的条目]
await updatePresetWith('in_use', preset => {
  preset.prompts.filter(prompt => prompt.name.includes('COT')).forEach(prompt => prompt.enabled = false);
  return preset;
});
```

```ts [为酒馆正在使用的预设添加一个提示词条目]
await updatePresetWith('in_use', preset => {
  preset.prompts.push({
    id: 'new_prompt',
    name: '新提示词',
    enabled: true,
    position: { type: 'relative' },
    role: 'user',
    content: '新提示词内容',
  });
  return preset;
}
```

```ts [将 '预设A' 的条目按顺序复制到 '预设B' 开头]
const preset_a = getPreset('预设A');
const preset_b = getPreset('预设B');
await updatePresetWith('预设B', preset => {
  preset.prompts = [...preset_a.prompts, ...preset.prompts];
  return preset;
});
```

:::

## setPreset

将预设内容修改回预设中, 如果某个内容不存在, 则该内容将会采用原来的值

```ts
function setPreset(
  preset_name: LiteralUnion<'in_use', string>,
  preset: PartialDeep<Preset>,
  { render }?: ReplacePresetOptions,
): Promise<Preset>;
```

### 参数

#### preset_name

- **类型**: `string`
- **描述**: 预设名称

#### preset

- **类型**: [`PartialDeep<Preset>`](./获取预设.md#getpreset)
- **描述**: 预设内容

#### `option?`

一个可选的配置对象, 包含以下属性:

- **`render`**: `debounced|immediate|none`
  - 如果对 `'in_use'` 预设进行操作, 应该防抖渲染 (debounced)、立即渲染 (immediate) 还是不刷新前端显示 (none)? 默认为性能更好的防抖渲染

### 返回值

- **更新后的预设内容**: [`Preset`](./获取预设.md#getpreset)

### 异常

- 如果预设不存在, 将会抛出异常
- 如果替换的预设内容中存在重复的系统/占位提示词, 将会抛出异常

### 示例

:::code-group

```ts [为酒馆正在使用的预设开启流式传输]
await setPreset('in_use', { settings: { should_stream: true } });
```

```ts [将 '预设A' 的条目按顺序复制到 '预设B' 开头]
const preset_a = getPreset('预设A');
const preset_b = getPreset('预设B');
await setPreset('预设B', {
  prompts: [...preset_a.prompts, ...preset_b.prompts],
});
```

:::
