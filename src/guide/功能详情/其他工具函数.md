---
order: 14
---

# å…¶ä»–å·¥å…·å‡½æ•°

:::tip
è¯·åŠ¡å¿…å…ˆé˜…è¯»[å¦‚ä½•æ­£ç¡®ä½¿ç”¨é…’é¦†åŠ©æ‰‹](/guide/åŸºæœ¬ç”¨æ³•/å¦‚ä½•æ­£ç¡®ä½¿ç”¨é…’é¦†åŠ©æ‰‹.md)
:::

[ç‚¹å‡»æŸ¥çœ‹å¯¹åº”ç±»å‹å®šä¹‰æ–‡ä»¶ (å¯å‘ç»™ AI æˆ– IDE ä½¿ç”¨, é…’é¦†åŠ©æ‰‹ç•Œé¢ä¸­æä¾›äº†æ‰“åŒ…ä¸‹è½½)](https://github.com/N0VI028/JS-Slash-Runner/blob/main/%40types/iframe/util.d.ts)

<CustomTOC />

## reloadIframe

åœ¨å‰ç«¯ç•Œé¢æˆ–è„šæœ¬å†…ä½¿ç”¨, ä»è€Œé‡æ–°åŠ è½½å‰ç«¯ç•Œé¢æˆ–è„šæœ¬.

è¿™ç›¸å½“äºè°ƒç”¨ `window.location.reload()`, ä¼šè®©åˆ†äº«åˆ°å…¨å±€çš„æ¥å£å¤±æ•ˆ; å¦‚æœæœ‰éœ€è¦åœ¨é‡æ–°åŠ è½½å‰ç«¯ç•Œé¢åæ²¿ç”¨çš„æ•°æ®, ä½ åº”è¯¥è‡ªè¡Œç¼–å†™é‡æ–°åŠ è½½æ–¹å¼è€Œä¸æ˜¯ä½¿ç”¨è¿™ä¸ªå‡½æ•°.

:::code-group

```[reloadIframe]
function reloadIframe(): void;
```

:::

### ç¤ºä¾‹

```ts
// å½“èŠå¤©æ–‡ä»¶å˜æ›´æ—¶, é‡æ–°åŠ è½½å‰ç«¯ç•Œé¢æˆ–è„šæœ¬
let current_chat_id = SillyTavern.getCurrentChatId();
eventOn(tavern_events.CHAT_CHANGED, chat_id => {
  if (current_chat_id !== chat_id) {
    current_chat_id = chat_id;
    reloadIframe();
  }
})
```

## substitudeMacros

æ›¿æ¢å­—ç¬¦ä¸²ä¸­çš„ SillyTavern å®

:::code-group

```ts [substitudeMacros]
function substitudeMacros(text: string): string;
```

:::

### å‚æ•°

#### `text`

- **ç±»å‹**: `string`
- **æè¿°**: éœ€è¦æ›¿æ¢çš„å­—ç¬¦ä¸²

### è¿”å›å€¼

- **æ›¿æ¢ç»“æœ**: `string`

### ç¤ºä¾‹

```ts
const text = substitudeMacros("{{char}} speaks in {{lastMessageId}}");
text === "å°‘å¥³æ­Œå‰§ speaks in 5";
```

## getLastMessageId

è·å–æœ€æ–°æ¥¼å±‚å·

:::code-group

```ts [getLastMessageId]
function getLastMessageId(): number;
```

:::

### è¿”å›å€¼

- **æœ€æ–°æ¥¼å±‚å·**: `number`

## errorCatched

åŒ…è£…ä»»æ„å‡½æ•°, è¿”å›ä¸€ä¸ªä¼šå°†æŠ¥é”™æ¶ˆæ¯é€šè¿‡é…’é¦†é€šçŸ¥æ˜¾ç¤ºå‡ºæ¥çš„åŒåŠŸèƒ½å‡½æ•°.

:::code-group

```ts [errorCatched]
function errorCatched<T extends any[], U>(fn: (...args: T) => U): (...args: T) => U;
```

:::

### å‚æ•°

#### `fn`

- **ç±»å‹**: `(...args: T) => U`
- **æè¿°**: è¦åŒ…è£…çš„å‡½æ•°

### è¿”å›å€¼

- **åŒ…è£…åçš„å‡½æ•°**: `(...args: T) => U`
- **æè¿°**: åŒ…è£…åçš„å‡½æ•°ä¼šæ•è· `fn` å‡½æ•°çš„æŠ¥é”™, å¹¶é€šè¿‡é…’é¦†é€šçŸ¥æ˜¾ç¤ºå‡ºæ¥

### ç¤ºä¾‹

```ts
function test() {
  throw Error(`test`);
}
const error_catched_test = errorCatched(test);
error_catched_test();
// é…’é¦†é€šçŸ¥: test
```

## getIframeName <Badge type="warning" text="ğŸš«TavernHelper" />

è·å–å‰ç«¯ç•Œé¢æˆ–è„šæœ¬çš„ iframe æ ‡è¯†åç§°

```ts
function getIframeName(): string;
```

### è¿”å›å€¼

- **iframe æ ‡è¯†åç§°**: `string`
  - å¯¹äºæ¥¼å±‚æ¶ˆæ¯æ˜¯ `TH-message--æ¥¼å±‚å·--å‰ç«¯ç•Œé¢æ˜¯è¯¥æ¥¼å±‚ç¬¬å‡ ä¸ªç•Œé¢`
  - å¯¹äºè„šæœ¬åº“æ˜¯ `TH-script--è„šæœ¬åç§°--è„šæœ¬id`

## getMessageId <Badge type="warning" text="ğŸš«TavernHelper" />

ä»å‰ç«¯ç•Œé¢çš„ iframe æ ‡è¯†åç§° `iframe_name` è·å–å®ƒæ‰€åœ¨æ¥¼å±‚çš„æ¥¼å±‚å·, **åªèƒ½å¯¹å‰ç«¯ç•Œé¢ iframe æ ‡è¯†åç§°ä½¿ç”¨**

```ts
function getMessageId(iframe_name: string): number;
```

### å‚æ•°

#### `iframe_name`

- **ç±»å‹**: `string`
- **æè¿°**: å‰ç«¯ç•Œé¢çš„ iframe æ ‡è¯†åç§°

### è¿”å›å€¼

- **æ¥¼å±‚å·**: `number`

### å¼‚å¸¸

- å¦‚æœæä¾›çš„ `iframe_name` ä¸æ˜¯å‰ç«¯ç•Œé¢ iframe æ ‡è¯†åç§°, å°†ä¼šæŠ›å‡ºé”™è¯¯

## getCurrentMessageId <Badge type="warning" text="ğŸš«TavernHelper" />

è·å–æœ¬å‰ç«¯ç•Œé¢æ‰€åœ¨æ¥¼å±‚çš„æ¥¼å±‚å·, **åªèƒ½åœ¨å‰ç«¯ç•Œé¢å†…ä½¿ç”¨**

```ts
function getCurrentMessageId(): number;
```

### è¿”å›å€¼

- **æ¥¼å±‚å·**: `number`

### å¼‚å¸¸

- å¦‚æœä¸åœ¨å‰ç«¯ç•Œé¢å†…ä½¿ç”¨, å°†ä¼šæŠ›å‡ºé”™è¯¯

## getScriptId <Badge type="warning" text="ğŸš«TavernHelper" />

è·å–è„šæœ¬åº“çš„è„šæœ¬ id

```ts
function getScriptId(): string;
```

### è¿”å›å€¼

- **è„šæœ¬ id**: `string`

### å¼‚å¸¸

- å¦‚æœä¸åœ¨è„šæœ¬å†…ä½¿ç”¨, å°†ä¼šæŠ›å‡ºé”™è¯¯
