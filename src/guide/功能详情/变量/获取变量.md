---
order: 1
---

# 获取变量

:::tip
请务必先阅读[如何正确使用酒馆助手](/guide/基本用法/如何正确使用酒馆助手.md)
:::

[点击查看对应类型定义文件 (可发给 AI 或 IDE 使用, 酒馆助手界面中提供了打包下载)](https://github.com/N0VI028/JS-Slash-Runner/blob/main/%40types/function/variables.d.ts)

<CustomTOC />

## getVariables

获取变量表

:::code-group

```ts [getVariables]
function getVariables(option: VariableOption): Record<string, any>
```

:::

### 参数

#### `option`

要操作的[变量类型](./变量类型.md)

### 返回值

- **变量表**: `Record<string, any>`

### 示例

:::code-group

```ts [获取所有聊天变量并弹窗输出结果]
const variables = getVariables({type: 'chat'});
alert(variables);
```

```ts [获取所有全局变量]
const variables = getVariables({type: 'global'});
// 酒馆助手内置了 lodash 库, 你能用它做很多事, 比如查询某个变量是否存在
if (_.has(variables, "神乐光.好感度")) {
  /* ... */
}
```

```ts [获取特定消息楼层的变量]
// 获取倒数第二楼层的聊天变量
const variables = getVariables({type: 'message', message_id: -2});
```

```ts [获取脚本变量]
// 在脚本内获取该脚本绑定的变量
const variables = getVariables({type: 'script', script_id: getScriptId()});
```

:::

## 在提示词中获取变量

你可以通过以下格式在提示词中获取变量:

### 变量示例

```ts
const 全局变量 = {
  神乐光: {
    好感度: 50,
  },
};

const 聊天变量 = {
  商品: [{ 内容: '...' }, { 内容: '...' }],
};

const 消息楼层变量 = {
  当前剧情阶段: '...',
};
```

你可以通过以下格式在提示词中获取他们:

- 全局变量: <code v-pre>{{get_global_variable::神乐光.好感度}}</code> 或 <code v-pre>{{format_global_variable::神乐光.好感度}}</code>
- 预设变量: <code v-pre>{{get_preset_variable::略}}</code> 或 <code v-pre>{{format_preset_variable::略}}</code>
- 角色卡变量: <code v-pre>{{get_character_variable::略}}</code> 或 <code v-pre>{{format_character_variable::略}}</code>
- 聊天变量: <code v-pre>{{get_chat_variable::商品.1.内容}}</code> 或 <code v-pre>{{format_chat_variable::商品.1.内容}}</code>
- 消息楼层变量, 将会获取到最新绑定的消息楼层变量: <code v-pre>{{get_message_variable::当前剧情阶段}}</code> 或 <code v-pre>{{format_message_variable::当前剧情阶段}}</code>

一般而言,

- <code v-pre>{{get_xxx_variable::变量}}</code> 获取到的结果与 `JSON.stringify(变量)` 一致
- <code v-pre>{{format_xxx_variable::变量}}</code> 获取到的结果与 `YAML.stringify(变量).trimEnd()` 一致

AI 对于 <code v-pre>{{format_xxx_variable::变量}}</code> 的理解更清晰, 你应该总是优先使用它而非 <code v-pre>{{get_xxx_variable::变量}}</code>.

但 <code v-pre>{{get/format_xxx_variable::变量}}</code> 宏有一个额外特性: 它会忽略变量中所有以 `$` 开头的键. 这个特性允许你在变量中存储一些不应该发给 AI 看的数据. 例如, 对于 `{ $meta: {}, 好感度: 0 }`, 它只会得到 `{ 好感度: 0 }`.
