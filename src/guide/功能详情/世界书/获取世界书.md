---
order: 0
---

# è·å–ä¸–ç•Œä¹¦

:::tip
è¯·åŠ¡å¿…å…ˆé˜…è¯»[å¦‚ä½•æ­£ç¡®ä½¿ç”¨é…’é¦†åŠ©æ‰‹](/guide/åŸºæœ¬ç”¨æ³•/å¦‚ä½•æ­£ç¡®ä½¿ç”¨é…’é¦†åŠ©æ‰‹.md)
:::

[ç‚¹å‡»æŸ¥çœ‹å¯¹åº”ç±»å‹å®šä¹‰æ–‡ä»¶ (å¯å‘ç»™ AI æˆ– IDE ä½¿ç”¨, é…’é¦†åŠ©æ‰‹ç•Œé¢ä¸­æä¾›äº†æ‰“åŒ…ä¸‹è½½)](https://github.com/N0VI028/JS-Slash-Runner/blob/main/%40types/function/worldbook.d.ts)

<CustomTOC />

## getWorldbook

è·å– `worldbook_name` ä¸–ç•Œä¹¦çš„å†…å®¹

:::code-group

```ts [getWorldbook]
function getWorldbook(worldbook_name: string): Promise<WorldbookEntry[]>;
```

```ts [WorldbookEntry]
type WorldbookEntry = {
  /** uid æ˜¯ç›¸å¯¹äºä¸–ç•Œä¹¦å†…éƒ¨çš„, ä¸è¦è·¨ä¸–ç•Œä¹¦ä½¿ç”¨ */
  uid: number;
  name: string;
  enabled: boolean;

  strategy: {
    /**
     * - `'constant'`: å¸¸é‡ğŸ”µ, ä¿—ç§°è“ç¯. åªéœ€è¦æ»¡è¶³ "å¯ç”¨"ã€"æ¿€æ´»æ¦‚ç‡%" ç­‰åˆ«çš„è¦æ±‚å³å¯.
     * - `'selective'`: å¯é€‰é¡¹ğŸŸ¢, ä¿—ç§°ç»¿ç¯. é™¤äº†è“ç¯æ¡ä»¶, è¿˜éœ€è¦æ»¡è¶³ `keys` æ‰«ææ¡ä»¶
     * - `'vectorized'`: å‘é‡åŒ–ğŸ”—. ä¸€èˆ¬ä¸ä½¿ç”¨
     */
    type: 'constant' | 'selective' | 'vectorized';
    /** ä¸»è¦å…³é”®å­—. ç»¿ç¯æ¡ç›®å¿…é¡»åœ¨æ¬²æ‰«ææ–‡æœ¬ä¸­æ‰«æåˆ°å…¶ä¸­ä»»æ„ä¸€ä¸ªå…³é”®å­—æ‰èƒ½æ¿€æ´» */
    keys: (string | RegExp)[];
    /**
     * æ¬¡è¦å…³é”®å­—. å¦‚æœæ•°ç»„ä¸ä¸ºç©º, åˆ™æ¡ç›®é™¤äº†åœ¨ä¸»è¦å…³é”®å­—ä¸­åŒ¹é…åˆ°ä»»æ„ä¸€ä¸ªå…³é”®å­—å¤–, è¿˜éœ€è¦æ»¡è¶³:
     * - `'and_any'`: æ¬¡è¦å…³é”®å­—ä¸­ä»»æ„ä¸€ä¸ªå…³é”®å­—èƒ½åœ¨æ¬²æ‰«ææ–‡æœ¬ä¸­åŒ¹é…åˆ°
     * - `'and_all'`: æ¬¡è¦å…³é”®å­—ä¸­æ‰€æœ‰å…³é”®å­—éƒ½èƒ½åœ¨æ¬²æ‰«ææ–‡æœ¬ä¸­åŒ¹é…åˆ°
     * - `'not_all'`: æ¬¡è¦å…³é”®å­—ä¸­è‡³å°‘æœ‰ä¸€ä¸ªå…³é”®å­—æ²¡èƒ½åœ¨æ¬²æ‰«ææ–‡æœ¬ä¸­åŒ¹é…åˆ°
     * - `'not_any'`: æ¬¡è¦å…³é”®å­—ä¸­æ‰€æœ‰å…³é”®å­—éƒ½æ²¡èƒ½æ¬²æ‰«ææ–‡æœ¬ä¸­åŒ¹é…åˆ°
     */
    keys_secondary: { logic: 'and_any' | 'and_all' | 'not_all' | 'not_any'; keys: (string | RegExp)[] };
    /** æ‰«ææ·±åº¦: 1 ä¸ºä»…æ‰«ææœ€åä¸€ä¸ªæ¥¼å±‚, 2 ä¸ºæ‰«ææœ€åä¸¤ä¸ªæ¥¼å±‚, ä»¥æ­¤ç±»æ¨ */
    scan_depth: 'same_as_global' | number;
  };
  position: {
    /**
     * ä½ç½®ç±»å‹:
     * - `'before_character_definition'`: è§’è‰²å®šä¹‰ä¹‹å‰
     * - `'after_character_definition'`: è§’è‰²å®šä¹‰ä¹‹å
     * - `'before_example_messages'`: ç¤ºä¾‹æ¶ˆæ¯ä¹‹å‰
     * - `'after_example_messages'`: ç¤ºä¾‹æ¶ˆæ¯ä¹‹å
     * - `'before_author_note'`: ä½œè€…æ³¨é‡Šä¹‹å‰
     * - `'after_author_note'`: ä½œè€…æ³¨é‡Šä¹‹å
     * - `'at_depth'`: æ’å…¥åˆ°æŒ‡å®šæ·±åº¦
     */
    type:
      | 'before_character_definition'
      | 'after_character_definition'
      | 'before_example_messages'
      | 'after_example_messages'
      | 'before_author_note'
      | 'after_author_note'
      | 'at_depth';
    /** è¯¥æ¡ç›®çš„æ¶ˆæ¯èº«ä»½, ä»…ä½ç½®ç±»å‹ä¸º `'at_depth'` æ—¶æœ‰æ•ˆ */
    role: 'system' | 'assistant' | 'user';
    /** è¯¥æ¡ç›®è¦æ’å…¥çš„æ·±åº¦, ä»…ä½ç½®ç±»å‹ä¸º `'at_depth'` æ—¶æœ‰æ•ˆ */
    depth: number;
    // TODO: ä¸–ç•Œä¹¦æ¡ç›®çš„æ’å…¥: æ–‡æ¡£é“¾æ¥
    order: number;
  };

  content: string;

  probability: number;
  recursion: {
    /** ç¦æ­¢å…¶ä»–æ¡ç›®é€’å½’æ¿€æ´»æœ¬æ¡ç›® */
    prevent_incoming: boolean;
    /** ç¦æ­¢æœ¬æ¡ç›®é€’å½’æ¿€æ´»å…¶ä»–æ¡ç›® */
    prevent_outgoing: boolean;
    /** å»¶è¿Ÿåˆ°ç¬¬ n çº§é€’å½’æ£€æŸ¥æ—¶æ‰èƒ½æ¿€æ´»æœ¬æ¡ç›® */
    delay_until: null | number;
  };
  effect: {
    /** é»æ€§: æ¡ç›®æ¿€æ´»å, åœ¨ä¹‹å `n` æ¡æ¶ˆæ¯å†…å§‹ç»ˆæ¿€æ´», æ— è§†æ¿€æ´»ç­–ç•¥ã€æ¿€æ´»æ¦‚ç‡% */
    sticky: null | number;
    /** å†·å´: æ¡ç›®æ¿€æ´»å, åœ¨ä¹‹å `n` æ¡æ¶ˆæ¯å†…ä¸èƒ½å†æ¿€æ´»*/
    cooldown: null | number;
    /** å»¶è¿Ÿ: èŠå¤©ä¸­è‡³å°‘æœ‰ `1` æ¥¼æ¶ˆæ¯æ—¶, æ‰èƒ½æ¿€æ´»æ¡ç›® */
    delay: null | number;
  };

  extra?: Record<string, any>;
};
```

:::

### å‚æ•°

#### `worldbook_name`

- **ç±»å‹**: `string`
- **æè¿°**: ä¸–ç•Œä¹¦åç§°

### è¿”å›å€¼

- **ä¸–ç•Œä¹¦å†…å®¹**: [`WorldbookEntry[]`](./è·å–ä¸–ç•Œä¹¦#getworldbook)

### å¼‚å¸¸

- å¦‚æœä¸–ç•Œä¹¦ä¸å­˜åœ¨, å°†ä¼šæŠ›å‡ºé”™è¯¯

## getWorldbookNames

è·å–ä¸–ç•Œä¹¦åç§°åˆ—è¡¨

```ts
function getWorldbookNames(): string[];
```

### è¿”å›å€¼

- **ä¸–ç•Œä¹¦åç§°åˆ—è¡¨**: `string[]`

## getGlobalWorldbookNames

è·å–å½“å‰å…¨å±€å¼€å¯çš„ä¸–ç•Œä¹¦åç§°åˆ—è¡¨

```ts
function getGlobalWorldbookNames(): string[];
```

### è¿”å›å€¼

- **å…¨å±€å¼€å¯çš„ä¸–ç•Œä¹¦åç§°åˆ—è¡¨**: `string[]`

## getCharWorldbookNames

è·å–è§’è‰²å¡ç»‘å®šçš„ä¸–ç•Œä¹¦

:::code-group

```ts [getCharWorldbookNames]
function getCharWorldbookNames(character_name: LiteralUnion<'current' | string>): CharWorldbooks;
```

```ts [CharWorldbooks]
type CharWorldbooks = {
  primary: string | null;
  additional: string[];
}
```

:::

### å‚æ•°

#### `character_name`

- **ç±»å‹**: `'current' | string`
- **æè¿°**: è§’è‰²å¡åç§°, 'current' è¡¨ç¤ºå½“å‰æ‰“å¼€çš„è§’è‰²å¡

### è¿”å›å€¼

- [**CharWorldbooks å¯¹è±¡**](./è·å–ä¸–ç•Œä¹¦#getCharWorldbookNames): è§’è‰²å¡ç»‘å®šçš„ä¸–ç•Œä¹¦

## getChatWorldbookName

è·å–èŠå¤©æ–‡ä»¶ç»‘å®šçš„ä¸–ç•Œä¹¦

```ts
function getChatWorldbookName(chat_name: 'current'): string | null;
```

### å‚æ•°

#### `chat_name`

- **ç±»å‹**: `'current' | string`
- **æè¿°**: èŠå¤©æ–‡ä»¶åç§°, 'current' è¡¨ç¤ºå½“å‰æ‰“å¼€çš„èŠå¤©æ–‡ä»¶

### è¿”å›å€¼

- **èŠå¤©æ–‡ä»¶ç»‘å®šçš„ä¸–ç•Œä¹¦**: `string | null`

## getOrCreateChatWorldbook

è·å–æˆ–æ–°å»ºèŠå¤©æ–‡ä»¶ä¸–ç•Œä¹¦

```ts
function getOrCreateChatWorldbook(chat_name: 'current', worldbook_name?: string): Promise<string>;
```

### å‚æ•°

#### `chat_name`

- **ç±»å‹**: `'current' | string`
- **æè¿°**: èŠå¤©æ–‡ä»¶åç§°, 'current' è¡¨ç¤ºå½“å‰æ‰“å¼€çš„èŠå¤©æ–‡ä»¶

#### `worldbook_name`

- **ç±»å‹**: `string`
- **æè¿°**: ä¸–ç•Œä¹¦åç§°; ä¸å¡«åˆ™æ ¹æ®å½“å‰æ—¶é—´åˆ›å»º

### è¿”å›å€¼

- **èŠå¤©æ–‡ä»¶ç»‘å®šçš„ä¸–ç•Œä¹¦**: `string`
