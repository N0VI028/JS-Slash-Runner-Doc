# è·å–ä¸–ç•Œä¹¦

<CustomTOC />

## getLorebooks

è·å–ä¸–ç•Œä¹¦åˆ—è¡¨ã€‚

```typescript
function getLorebooks(): string[];
```

### è¿”å›å€¼

- **ä¸–ç•Œä¹¦åç§°åˆ—è¡¨**: `string[]`

## getLorebookEntries

è·å–ä¸–ç•Œä¹¦ä¸­çš„æ¡ç›®ä¿¡æ¯ã€‚

:::code-group

```typescript [getLorebookEntries]
function getLorebookEntries(lorebook: string): Promise<LorebookEntry[]>;
```

```typescript [GetLorebookEntriesOption]
interface GetLorebookEntriesOption {
  filter?: "none" | Partial<LorebookEntry>; // æŒ‰ç…§æŒ‡å®šå­—æ®µå€¼ç­›é€‰æ¡ç›®
}
```

```typescript [LorebookEntry]
interface LorebookEntry {
  uid: number; // uid æ˜¯ç›¸å¯¹äºä¸–ç•Œä¹¦å†…éƒ¨çš„ï¼Œä¸è¦è·¨ä¸–ç•Œä¹¦ä½¿ç”¨
  display_index: number; // é…’é¦†ä¸­å°†æ’åºè®¾ç½®ä¸º "è‡ªå®šä¹‰" æ—¶çš„æ˜¾ç¤ºé¡ºåº

  comment: string;
  enabled: boolean;
  type: "constant" | "selective" | "vectorized";
  position:
    | "before_character_definition" // è§’è‰²å®šä¹‰ä¹‹å‰
    | "after_character_definition" // è§’è‰²å®šä¹‰ä¹‹å
    | "before_example_messages" // ç¤ºä¾‹æ¶ˆæ¯ä¹‹å‰
    | "after_example_messages" // ç¤ºä¾‹æ¶ˆæ¯ä¹‹å
    | "before_author_note" // ä½œè€…æ³¨é‡Šä¹‹å‰
    | "after_author_note" // ä½œè€…æ³¨é‡Šä¹‹å
    | "at_depth_as_system" // @Dâš™
    | "at_depth_as_assistant" // @DğŸ‘¤
    | "at_depth_as_user"; // @DğŸ¤–
  depth: number | null; // ä»…å¯¹äº `position === 'at_depth_as_???'` æœ‰æ„ä¹‰ï¼›å…¶ä»–æƒ…å†µä¸º null
  order: number;
  probability: number;

  keys: string[];
  logic: "and_any" | "and_all" | "not_all" | "not_any";
  filters: string[];

  scan_depth: "same_as_global" | number;
  case_sensitive: "same_as_global" | boolean;
  match_whole_words: "same_as_global" | boolean;
  use_group_scoring: "same_as_global" | boolean;
  automation_id: string | null;

  exclude_recursion: boolean;
  prevent_recursion: boolean;
  delay_until_recursion: boolean | number; // å¯ç”¨åˆ™æ˜¯ true, å¦‚æœè®¾ç½®äº†å…·ä½“çš„ Recursion Level åˆ™æ˜¯æ•°å­—

  content: string;

  group: string;
  group_prioritized: boolean;
  group_weight: number;
  sticky: number | null;
  cooldown: number | null;
  delay: number | null;
}
```

:::

### å‚æ•°

#### `lorebook`

- **ç±»å‹**: `string`
- **æè¿°**: ä¸–ç•Œä¹¦åç§°

:::warning
æ³¨æ„ï¼šç±»å‹å®šä¹‰ä¸­ `getLorebookEntries` ä¸å†æ¥å— `option` å‚æ•°ï¼Œä¸ºäº†ä¿æŒå…¼å®¹æ€§ï¼Œå¦‚æœéœ€è¦ç­›é€‰ï¼Œè¯·è·å–æ‰€æœ‰æ¡ç›®åè‡ªè¡Œç­›é€‰ã€‚
:::

### ç¤ºä¾‹

:::code-group

```typescript [è·å–æ‰€æœ‰æ¡ç›®]
// è·å–ä¸–ç•Œä¹¦ä¸­æ‰€æœ‰æ¡ç›®çš„æ‰€æœ‰ä¿¡æ¯
const entries = await getLorebookEntries("eramgtå°‘å¥³æ­Œå‰§");
```

```typescript [æŒ‰å†…å®¹ç­›é€‰]
// æŒ‰å†…å®¹ç­›é€‰ï¼Œcontent ä¸­å¿…é¡»å‡ºç° `'ç¥ä¹å…‰'`
const entries = await getLorebookEntries("eramgtå°‘å¥³æ­Œå‰§");
const filteredEntries = entries.filter(entry => entry.content.includes("ç¥ä¹å…‰"));
```

:::

## getLorebookSettings

è·å–å½“å‰çš„ä¸–ç•Œä¹¦å…¨å±€è®¾ç½®ã€‚

:::code-group

```typescript [getLorebookSettings]
function getLorebookSettings(): LorebookSettings;
```

```typescript [LorebookSettings]
interface LorebookSettings {
  selected_global_lorebooks: string[];

  scan_depth: number;
  context_percentage: number;
  budget_cap: number; // 0 è¡¨ç¤ºç¦ç”¨
  min_activations: number;
  max_depth: number; // 0 è¡¨ç¤ºæ— é™åˆ¶
  max_recursion_steps: number;

  include_names: boolean;
  recursive: boolean;
  case_sensitive: boolean;
  match_whole_words: boolean;
  use_group_scoring: boolean;
  overflow_alert: boolean;

  insertion_strategy: "evenly" | "character_first" | "global_first";
}
```

:::

### è¿”å›å€¼

- **selected_global_lorebooks**: `string[]`
- **scan_depth**: `number`
- **context_percentage**: `number`
- **budget_cap**: `number`
- **min_activations**: `number`
- **max_depth**: `number`
- **max_recursion_steps**: `number`
- **include_names**: `boolean`
- **recursive**: `boolean`
- **case_sensitive**: `boolean`
- **match_whole_words**: `boolean`
- **use_group_scoring**: `boolean`
- **overflow_alert**: `boolean`
- **insertion_strategy**: `"evenly" | "character_first" | "global_first"`

### ç¤ºä¾‹

```typescript
// è·å–å…¨å±€å¯ç”¨çš„ä¸–ç•Œä¹¦
const settings = getLorebookSettings();
alert(settings.selected_global_lorebooks);
```

## getCharLorebooks

è·å–è§’è‰²å¡ç»‘å®šçš„ä¸–ç•Œä¹¦ã€‚

:::code-group

```typescript [getCharLorebooks]
function getCharLorebooks({ name, type }?: GetCharLorebooksOption): CharLorebooks;
```

```typescript [CharLorebooks]
interface CharLorebooks {
  primary: string | null;
  additional: string[];
}
```

```typescript [GetCharLorebooksOption]
interface GetCharLorebooksOption {
  name?: string; // è¦æŸ¥è¯¢çš„è§’è‰²å¡åç§°ï¼›é»˜è®¤ä¸ºå½“å‰è§’è‰²å¡
  type?: "all" | "primary" | "additional"; // æŒ‰è§’è‰²ä¸–ç•Œä¹¦çš„ç»‘å®šç±»å‹ç­›é€‰ä¸–ç•Œä¹¦ï¼›é»˜è®¤ä¸º 'all'
}
```

:::

### å‚æ•°

#### `name?`

- **ç±»å‹**: `string`
- **æè¿°**: è¦æŸ¥è¯¢çš„è§’è‰²å¡åç§°ï¼›é»˜è®¤ä¸ºå½“å‰è§’è‰²å¡

#### `type?`

- **ç±»å‹**: `"all" | "primary" | "additional"`
- **æè¿°**: æŒ‰è§’è‰²ä¸–ç•Œä¹¦çš„ç»‘å®šç±»å‹ç­›é€‰ä¸–ç•Œä¹¦ï¼›é»˜è®¤ä¸º `"all"`

### è¿”å›å€¼

- **CharLorebooks å¯¹è±¡**: `{ primary: string | null; additional: string[]; }` - ä¸»è¦ä¸–ç•Œä¹¦åç§°å’Œé™„åŠ ä¸–ç•Œä¹¦åç§°åˆ—è¡¨

### ç¤ºä¾‹

:::code-group
```typescript [è·å–å½“å‰è§’è‰²å¡ç»‘å®šçš„æ‰€æœ‰ä¸–ç•Œä¹¦]
const lorebooks = getCharLorebooks();
```
```typescript [è·å–å½“å‰è§’è‰²å¡ç»‘å®šçš„ä¸»è¦ä¸–ç•Œä¹¦]
const lorebooks = getCharLorebooks({ type: "primary" });
console.log(lorebooks.primary);
```
:::

## getCurrentCharPrimaryLorebook

è·å–å½“å‰è§’è‰²å¡ç»‘å®šçš„ä¸»è¦ä¸–ç•Œä¹¦ã€‚

```typescript
function getCurrentCharPrimaryLorebook(): string | null;
```

### è¿”å›å€¼

- **ä¸»è¦ä¸–ç•Œä¹¦åç§°**: `string | null` - å¦‚æœå½“å‰è§’è‰²å¡æœ‰ç»‘å®šå¹¶ä½¿ç”¨ä¸–ç•Œä¹¦ (åœ°çƒå›¾æ ‡å‘ˆç»¿è‰²), è¿”å›è¯¥ä¸–ç•Œä¹¦çš„åç§°ï¼›å¦åˆ™è¿”å› `null`

## getChatLorebook

è·å–å½“å‰èŠå¤©ç»‘å®šçš„ä¸–ç•Œä¹¦ã€‚

```typescript
async function getChatLorebook(): Promise<string | null>;
```

### è¿”å›å€¼

- **èŠå¤©ä¸–ç•Œä¹¦åç§°**: `string | null` - å½“å‰èŠå¤©ç»‘å®šçš„ä¸–ç•Œä¹¦åç§°ï¼Œæˆ– null è¡¨ç¤ºæ²¡æœ‰ç»‘å®šä¸–ç•Œä¹¦

## setChatLorebook

è®¾ç½®å½“å‰èŠå¤©ç»‘å®šçš„ä¸–ç•Œä¹¦ã€‚

```typescript
async function setChatLorebook(lorebook: string | null): Promise<void>;
```

### å‚æ•°

#### `lorebook`

- **ç±»å‹**: `string | null`
- **æè¿°**: ä¸–ç•Œä¹¦åç§°ï¼Œæˆ– null è¡¨ç¤ºç§»é™¤ä¸–ç•Œä¹¦

## getOrCreateChatLorebook

è·å–æˆ–åˆ›å»ºå½“å‰èŠå¤©ç»‘å®šçš„ä¸–ç•Œä¹¦ã€‚

```typescript
async function getOrCreateChatLorebook(lorebook?: string): Promise<string>;
```

### å‚æ•°

#### `lorebook?`

- **ç±»å‹**: `string`
- **æè¿°**: å¯é€‰å‚æ•°ï¼ŒæŒ‡å®šä¸–ç•Œä¹¦åç§°ï¼›å¦‚æœæœªæŒ‡å®šï¼Œåˆ™æ ¹æ®èŠå¤©æ–‡ä»¶åè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªä¸–ç•Œä¹¦åç§°

### è¿”å›å€¼

- **èŠå¤©ä¸–ç•Œä¹¦åç§°**: `string`

