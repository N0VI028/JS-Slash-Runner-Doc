# åˆ›å»ºä¸–ç•Œä¹¦

:::tip
è¯·åŠ¡å¿…å…ˆé˜…è¯»[å¦‚ä½•æ­£ç¡®ä½¿ç”¨é…’é¦†åŠ©æ‰‹](/guide/åŸºæœ¬ç”¨æ³•/å¦‚ä½•æ­£ç¡®ä½¿ç”¨é…’é¦†åŠ©æ‰‹.md)
:::

<CustomTOC />

## createWorldbook

åˆ›å»ºæ–°çš„ä¸–ç•Œä¹¦ã€‚

:::code-group

```typescript [createWorldbook]

function createWorldbook(worldbook_name: string, worldbook?: WorldbookEntry[]): Promise<boolean>;
```

```typescript [WorldbookEntry]
type WorldbookEntry = {
  /** uid æ˜¯ç›¸å¯¹äºä¸–ç•Œä¹¦å†…éƒ¨çš„, ä¸è¦è·¨ä¸–ç•Œä¹¦ä½¿ç”¨ */
  uid: number;
  name: string;
  enabled: boolean;

  strategy: {
    /**
     * - `'constant'`: å¸¸é‡ğŸ”µ, ä¿—ç§°è“ç¯. åªéœ€è¦æ»¡è¶³ "å¯ç”¨"ã€"æ¿€æ´»æ¦‚ç‡%" ç­‰åˆ«çš„è¦æ±‚å³å¯.
     * - `'selective'`: å¯é€‰é¡¹ğŸŸ¢, ä¿—ç§°ç»¿ç¯. é™¤äº†è“ç¯æ¡ä»¶, è¿˜éœ€è¦æ»¡è¶³ `keys` æ‰«ææ¡ä»¶
     * - `'vectorized'`: å‘é‡åŒ–ğŸ”—. ä¸€èˆ¬ä¸ä½¿ç”¨
     */
    type: 'constant' | 'selective' | 'vectorized';
    /** ä¸»è¦å…³é”®å­—. ç»¿ç¯æ¡ç›®å¿…é¡»åœ¨æ¬²æ‰«ææ–‡æœ¬ä¸­æ‰«æåˆ°å…¶ä¸­ä»»æ„ä¸€ä¸ªå…³é”®å­—æ‰èƒ½æ¿€æ´» */
    keys: (string | RegExp)[];
    /**
     * æ¬¡è¦å…³é”®å­—. å¦‚æœæ•°ç»„ä¸ä¸ºç©º, åˆ™æ¡ç›®é™¤äº†åœ¨ä¸»è¦å…³é”®å­—ä¸­åŒ¹é…åˆ°ä»»æ„ä¸€ä¸ªå…³é”®å­—å¤–, è¿˜éœ€è¦æ»¡è¶³:
     * - `'and_any'`: æ¬¡è¦å…³é”®å­—ä¸­ä»»æ„ä¸€ä¸ªå…³é”®å­—èƒ½åœ¨æ¬²æ‰«ææ–‡æœ¬ä¸­åŒ¹é…åˆ°
     * - `'and_all'`: æ¬¡è¦å…³é”®å­—ä¸­æ‰€æœ‰å…³é”®å­—éƒ½èƒ½åœ¨æ¬²æ‰«ææ–‡æœ¬ä¸­åŒ¹é…åˆ°
     * - `'not_all'`: æ¬¡è¦å…³é”®å­—ä¸­è‡³å°‘æœ‰ä¸€ä¸ªå…³é”®å­—æ²¡èƒ½åœ¨æ¬²æ‰«ææ–‡æœ¬ä¸­åŒ¹é…åˆ°
     * - `'not_any'`: æ¬¡è¦å…³é”®å­—ä¸­æ‰€æœ‰å…³é”®å­—éƒ½æ²¡èƒ½æ¬²æ‰«ææ–‡æœ¬ä¸­åŒ¹é…åˆ°
     */
    keys_secondary: { logic: 'and_any' | 'and_all' | 'not_all' | 'not_any'; keys: (string | RegExp)[] };
    /** æ‰«ææ·±åº¦: 1 ä¸ºä»…æ‰«ææœ€åä¸€ä¸ªæ¥¼å±‚, 2 ä¸ºæ‰«ææœ€åä¸¤ä¸ªæ¥¼å±‚, ä»¥æ­¤ç±»æ¨ */
    scan_depth: 'same_as_global' | number;
  };
  position: {
    /**
     * ä½ç½®ç±»å‹:
     * - `'before_character_definition'`: è§’è‰²å®šä¹‰ä¹‹å‰
     * - `'after_character_definition'`: è§’è‰²å®šä¹‰ä¹‹å
     * - `'before_example_messages'`: ç¤ºä¾‹æ¶ˆæ¯ä¹‹å‰
     * - `'after_example_messages'`: ç¤ºä¾‹æ¶ˆæ¯ä¹‹å
     * - `'before_author_note'`: ä½œè€…æ³¨é‡Šä¹‹å‰
     * - `'after_author_note'`: ä½œè€…æ³¨é‡Šä¹‹å
     * - `'at_depth'`: æ’å…¥åˆ°æŒ‡å®šæ·±åº¦
     */
    type:
      | 'before_character_definition'
      | 'after_character_definition'
      | 'before_example_messages'
      | 'after_example_messages'
      | 'before_author_note'
      | 'after_author_note'
      | 'at_depth';
    /** è¯¥æ¡ç›®çš„æ¶ˆæ¯èº«ä»½, ä»…ä½ç½®ç±»å‹ä¸º `'at_depth'` æ—¶æœ‰æ•ˆ */
    role: 'system' | 'assistant' | 'user';
    /** è¯¥æ¡ç›®è¦æ’å…¥çš„æ·±åº¦, ä»…ä½ç½®ç±»å‹ä¸º `'at_depth'` æ—¶æœ‰æ•ˆ */
    depth: number;
    // TODO: ä¸–ç•Œä¹¦æ¡ç›®çš„æ’å…¥: æ–‡æ¡£é“¾æ¥
    order: number;
  };

  content: string;

  probability: number;
  recursion: {
    /** ç¦æ­¢å…¶ä»–æ¡ç›®é€’å½’æ¿€æ´»æœ¬æ¡ç›® */
    prevent_incoming: boolean;
    /** ç¦æ­¢æœ¬æ¡ç›®é€’å½’æ¿€æ´»å…¶ä»–æ¡ç›® */
    prevent_outgoing: boolean;
    /** å»¶è¿Ÿåˆ°ç¬¬ n çº§é€’å½’æ£€æŸ¥æ—¶æ‰èƒ½æ¿€æ´»æœ¬æ¡ç›® */
    delay_until: null | number;
  };
  effect: {
    /** é»æ€§: æ¡ç›®æ¿€æ´»å, åœ¨ä¹‹å `n` æ¡æ¶ˆæ¯å†…å§‹ç»ˆæ¿€æ´», æ— è§†æ¿€æ´»ç­–ç•¥ã€æ¿€æ´»æ¦‚ç‡% */
    sticky: null | number;
    /** å†·å´: æ¡ç›®æ¿€æ´»å, åœ¨ä¹‹å `n` æ¡æ¶ˆæ¯å†…ä¸èƒ½å†æ¿€æ´»*/
    cooldown: null | number;
    /** å»¶è¿Ÿ: èŠå¤©ä¸­è‡³å°‘æœ‰ `1` æ¥¼æ¶ˆæ¯æ—¶, æ‰èƒ½æ¿€æ´»æ¡ç›® */
    delay: null | number;
  };

  extra?: Record<string, any>;
};
```

:::

### å‚æ•°

#### `worldbook_name`

- **ç±»å‹**: `string`
- **æè¿°**: ä¸–ç•Œä¹¦åç§°

#### `worldbook`

- **ç±»å‹**: [`WorldbookEntry[]`](./åˆ›å»ºä¸–ç•Œä¹¦#createworldbook)
- **æè¿°**: ä¸–ç•Œä¹¦å†…å®¹; ä¸å¡«åˆ™æ²¡æœ‰ä»»ä½•æ¡ç›®

### è¿”å›å€¼

- **æ˜¯å¦æˆåŠŸåˆ›å»º**: `boolean` - å¦‚æœå·²ç»å­˜åœ¨åŒåä¸–ç•Œä¹¦ä¼šå¤±è´¥

## createOrReplaceWorldbook

åˆ›å»ºæˆ–æ›¿æ¢åä¸º `worldbook_name` çš„ä¸–ç•Œä¹¦, å†…å®¹ä¸º `worldbook`

```typescript
function createOrReplaceWorldbook(worldbook_name: string, worldbook?: WorldbookEntry[]): Promise<boolean>;
```

### å‚æ•°

#### `worldbook_name`

- **ç±»å‹**: `string`
- **æè¿°**: ä¸–ç•Œä¹¦åç§°

#### `worldbook`

- **ç±»å‹**: [`WorldbookEntry[]`](./åˆ›å»ºä¸–ç•Œä¹¦#createworldbook)
- **æè¿°**: ä¸–ç•Œä¹¦å†…å®¹; ä¸å¡«åˆ™æ²¡æœ‰ä»»ä½•æ¡ç›®

### è¿”å›å€¼

- **æ˜¯å¦æˆåŠŸåˆ›å»ºæˆ–æ›¿æ¢**: `boolean` - å¦‚æœå‘ç”Ÿåˆ›å»º, åˆ™è¿”å› `true`; å¦‚æœå‘ç”Ÿæ›¿æ¢, åˆ™è¿”å› `false`
