# 修改世界书

:::tip
请务必先阅读[如何正确使用酒馆助手](/guide/基本用法/如何正确使用酒馆助手.md)
:::

[点击查看对应类型定义文件（可发给AI或IDE使用，酒馆助手设置中提供了打包下载）](https://github.com/N0VI028/JS-Slash-Runner/blob/main/%40types/function/worldbook.d.ts)

<CustomTOC />

## rebindGlobalWorldbooks

重新绑定全局世界书。

```typescript
function rebindGlobalWorldbooks(worldbook_names: string[]): Promise<void>;
```

### 参数

#### `worldbook_names`

- **类型**: `string[]`
- **描述**: 要全局开启的世界书名称列表

## rebindCharWorldbooks

重新绑定角色卡世界书。

```typescript
function rebindCharWorldbooks(character_name: 'current', char_worldbooks: CharWorldbooks): Promise<void>;
```

### 参数

#### `character_name`

- **类型**: `'current' | string`
- **描述**: 角色卡名称, 'current' 表示当前打开的角色卡

#### `char_worldbooks`

- **类型**: [`CharWorldbooks`](./获取世界书#getcharworldbooks)
- **描述**: 要对该角色卡绑定的世界书

## rebindChatWorldbook

重新绑定聊天文件世界书。

```typescript
function rebindChatWorldbook(chat_name: 'current', worldbook_name: string): Promise<void>;
```

### 参数

#### `chat_name`

- **类型**: `'current' | string`
- **描述**: 聊天文件名称, 'current' 表示当前打开的聊天文件

## replaceWorldbook

完全替换 `worldbook_name` 世界书的内容为 `worldbook`

```typescript
function replaceWorldbook(worldbook_name: string, worldbook: PartialDeep<WorldbookEntry>[]): Promise<void>;
```

### 参数

#### `worldbook_name`

- **类型**: `string`
- **描述**: 世界书名称

#### `worldbook`

- **类型**: [`PartialDeep<WorldbookEntry>[]`](./创建世界书#createworldbook)
- **描述**: 要替换的世界书内容

### 示例

:::code-group

```typescript [禁止所有条目递归, 保持其他设置不变]
// 禁止所有条目递归, 保持其他设置不变
const worldbook = await getWorldbook("eramgt少女歌剧");
await replaceWorldbook(
  'eramgt少女歌剧',
  worldbook.map(entry => ({
    ...entry,
    recursion: { prevent_incoming: true, prevent_outgoing: true, delay_until: null },
  })),
);
```

```typescript [删除所有名字中包含 "神乐光" 的条目]
const worldbook = await getWorldbook("eramgt少女歌剧");
_.remove(worldbook, entry => entry.name.includes('神乐光'));
await replaceWorldbook("eramgt少女歌剧", worldbook);
```

:::

## updateWorldbookWith

用 `updater` 函数更新世界书 `worldbook_name`

:::code-group

```typescript[updateWorldbookWith]
function updateWorldbookWith(worldbook_name: string, updater: WorldbookUpdater): Promise<WorldbookEntry[]>;
```

```typescript[WorldbookUpdater]
type WorldbookUpdater =
  | ((worldbook: WorldbookEntry[]) => PartialDeep<WorldbookEntry>[])
  | ((worldbook: WorldbookEntry[]) => Promise<PartialDeep<WorldbookEntry>[]>);
```

:::

### 参数

#### `worldbook_name`

- **类型**: `string`
- **描述**: 世界书名称  

#### `updater`

- **类型**: [`WorldbookUpdater`](./修改世界书#updateworldbookwith)
- **描述**: 用于更新世界书的函数。它应该接收世界书条目作为参数，并返回更新后的世界书条目。

### 返回值

- **更新后的世界书条目**: [`WorldbookEntry[]`](./创建世界书#createworldbook)

### 示例

```typescript [删除所有名字中包含 "神乐光" 的条目]
await updateWorldbookWith("eramgt少女歌剧", worldbook => worldbook.filter(entry => entry.name.includes('神乐光')));
```

## createWorldbookEntries

向世界书 `worldbook_name` 中新增条目

```typescript
function createWorldbookEntries(worldbook_name: string, new_entries: PartialDeep<WorldbookEntry>[]): Promise<{ worldbook: WorldbookEntry[]; new_entries: WorldbookEntry[] }>;
```

### 参数

#### `worldbook_name`

- **类型**: `string`
- **描述**: 世界书名称

#### `new_entries`

- **类型**: [`PartialDeep<WorldbookEntry>[]`](./创建世界书#createworldbook)
- **描述**: 要新增的条目

### 返回值

- **更新后的世界书条目**: [`WorldbookEntry[]`](./创建世界书#createworldbook)
- **新增的条目**: [`WorldbookEntry[]`](./创建世界书#createworldbook)

### 示例

```typescript [创建两个条目, 一个标题叫 "神乐光", 一个留白]
const { worldbook, new_entries } = await createWorldbookEntries('eramgt少女歌剧', [{ name: '神乐光' }, {}]);
```

## deleteWorldbookEntries

删除世界书 `worldbook_name` 中的条目

```typescript
function deleteWorldbookEntries(worldbook_name: string, predicate: (entry: WorldbookEntry) => boolean): Promise<{ worldbook: WorldbookEntry[]; deleted_entries: WorldbookEntry[] }>;
```

### 参数

#### `worldbook_name`

- **类型**: `string`
- **描述**: 世界书名称

#### `predicate`

- **类型**: [`(entry: WorldbookEntry) => boolean`](./创建世界书#createworldbook)
- **描述**: 要删除的条目

### 返回值

- **更新后的世界书条目**: [`WorldbookEntry[]`](./创建世界书#createworldbook)
- **被删除的条目**: [`WorldbookEntry[]`](./创建世界书#createworldbook)

### 示例

```typescript [删除所有名字中包含 "神乐光" 的条目]
const { worldbook, deleted_entries } = await deleteWorldbookEntries('eramgt少女歌剧', entry => entry.name.includes('神乐光'));
```
