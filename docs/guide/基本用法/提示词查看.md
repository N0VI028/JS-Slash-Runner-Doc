# 提示词查看

提示词查看功能用于模拟酒馆消息的发送，获取实际发送给AI的提示词内容，它会显示**酒馆经过处理后最终发给 ai 的提示词**, 因此将正确处理一些特殊机制, 得到**真实的提示词和相对真实的提示词 token 数**，便于预设与角色卡创作等的调试。

![提示词查看](/提示词查看.png)

## 功能入口

提示词查看功能有两个快捷入口：

- 入口1：在酒馆助手的工具箱中，点击“提示词查看”按钮
![提示词查看入口1](/变量管理器入口1.png)

- 入口2：在酒馆发送栏的左侧，点击魔法棒图标内的“提示词查看”按钮
![提示词查看入口2](/变量管理器入口2.png)


## 特性

- 支持随消息发送自动刷新
- 可点击刷新按钮，手动模拟一次消息发送（不会实际触发AI回复）
- 可按内容搜索（支持正则表达式），以及根据消息role筛选
- 搜索时勾选“仅显示匹配”可在搜索结果中折叠匹配部分外的上下文
- **展示提示词中特殊机制的处理结果：**
    - 世界书绿灯条目的激活
    - 预设和api的 "消息合并" 功能
    - 提示词模板
    - 酒馆、酒馆助手宏
    - 角色卡里其他监听提示词发送而进行的脚本

## UI界面

### 刷新按钮

位于token与消息条目计数的右方，点击后会模拟一次消息发送，并强制刷新提示词查看结果。本次发送不会触发AI回复，因此不会产生额度消耗。

![提示词查看刷新](/提示词查看刷新.png)

### 筛选功能

分为消息筛选和内容搜索两部分，应用筛选时，token数和消息条目计数会自动更新。

#### role筛选

可以按消息role筛选，支持系统（system）、助手（assistant）、用户（user）三种角色。

![提示词查看角色筛选](/提示词查看角色筛选.png)

#### 内容搜索

搜索提示词中的特定关键词，支持正则表达式，并且可以通过勾选“仅显示匹配”在搜索结果中折叠匹配部分外的上下文，减少搜索结果的干扰。

**普通搜索-不使用正则表达式**

![提示词查看普通搜索-不使用正则表达式](/提示词查看普通搜索_无正则.png)

**普通搜索-使用正则表达式**

![提示词查看普通搜索-使用正则表达式](/提示词查看普通搜索_有正则.png)

**仅显示匹配搜索**

![提示词查看仅显示匹配](/提示词查看仅显示匹配搜索.png)


